"use strict";(self.webpackChunk_kiebitz_apps_ffm=self.webpackChunk_kiebitz_apps_ffm||[]).push([[3461],{"./src/apps/mediator/WelcomePage.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,default:()=>WelcomePage_stories});var react=__webpack_require__("./node_modules/react/index.js"),MediatorApiContext=__webpack_require__("./src/apps/mediator/common/MediatorApiContext.tsx"),esm=__webpack_require__("./node_modules/@lingui/react/esm/index.js"),react_router=__webpack_require__("./node_modules/react-router/index.js"),ui=__webpack_require__("./src/ui/index.ts"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const WelcomePage=()=>{const[authenticated,setAuthenticated]=(0,react.useState)(!1),[invalidFile,setInvalidFile]=(0,react.useState)(!1),api=(0,MediatorApiContext.s)(),navigate=(0,react_router.s0)();(0,react.useEffect)((()=>{api.isAuthenticated().then((isAuthenticated=>{isAuthenticated&&navigate("/mediator/providers")}))}),[api,authenticated,navigate]);return(0,jsx_runtime.jsx)("main",{children:(0,jsx_runtime.jsxs)(ui.$0,{className:"mt-10 w-full sm:mt-0",children:[(0,jsx_runtime.jsx)(ui.Dx,{className:"text-2xl font-bold leading-relaxed text-gray-900",children:(0,jsx_runtime.jsx)(esm.cC,{id:"mediator.welcome.title"})}),(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)(ui.Dx,{variant:"h3",children:(0,jsx_runtime.jsx)(esm.cC,{id:"mediator.welcome.upload-key-pairs"})}),invalidFile&&(0,jsx_runtime.jsx)(ui.v0,{variant:"secondary",children:(0,jsx_runtime.jsx)(esm.cC,{id:"mediator.welcome.upload-key-pairs.invalid-file"})}),!invalidFile&&(0,jsx_runtime.jsx)(ui.xv,{children:(0,jsx_runtime.jsx)(esm.cC,{id:"mediator.welcome.upload-key-pairs.notice"})}),(0,jsx_runtime.jsx)("form",{children:(0,jsx_runtime.jsxs)("label",{htmlFor:"file-upload",className:"relative cursor-pointer button primary md",children:[(0,jsx_runtime.jsx)(esm.cC,{id:"mediator.welcome.upload-key-pairs.input"}),(0,jsx_runtime.jsx)("input",{id:"file-upload",className:"absolute inset-0 w-auto opacity-0 -z-10",type:"file",onChange:event=>{var _event$target$files;const file=null===(_event$target$files=event.target.files)||void 0===_event$target$files?void 0:_event$target$files[0];if(file){const reader=new FileReader;reader.onload=function(e){var _e$target;if(null!==(_e$target=e.target)&&void 0!==_e$target&&_e$target.result&&"string"==typeof e.target.result){const keyPairs=JSON.parse(e.target.result);void 0===keyPairs.signing||void 0===keyPairs.encryption||void 0===keyPairs.provider?setInvalidFile(!0):api.authenticate(keyPairs).then((isAuthenticated=>{setAuthenticated(isAuthenticated)}))}},reader.readAsBinaryString(file)}}})]})})]})]})})};WelcomePage.displayName="WelcomePage";var mediator_WelcomePage=WelcomePage;try{WelcomePage.displayName="WelcomePage",WelcomePage.__docgenInfo={description:"",displayName:"WelcomePage",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/apps/mediator/WelcomePage.tsx#WelcomePage"]={docgenInfo:WelcomePage.__docgenInfo,name:"WelcomePage",path:"src/apps/mediator/WelcomePage.tsx#WelcomePage"})}catch(__react_docgen_typescript_loader_error){}var WelcomePage_stories={component:mediator_WelcomePage};const Default=()=>(0,jsx_runtime.jsx)(MediatorApiContext.d,{children:(0,jsx_runtime.jsx)(mediator_WelcomePage,{})});Default.displayName="Default",Default.parameters={storySource:{source:"() => (\n    <MediatorApiProvider>\n        <WelcomePage />\n    </MediatorApiProvider>\n)"},...Default.parameters}},"./src/apps/mediator/common/MediatorApiContext.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{d:()=>MediatorApiProvider,s:()=>useMediatorApi});var data=__webpack_require__("./src/apps/data.ts"),dist=__webpack_require__("./node_modules/vanellus/dist/index.js"),backend=__webpack_require__("./src/backend/backend.ts");class MediatorApi{constructor(){!function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}(this,"keyPairs",null),this.mediator=new dist.Mediator("main",backend.y)}async authenticate(keyPairs){return this.keyPairs=keyPairs,!0}async isAuthenticated(){return!!this.keyPairs}async logout(){return!0}async getProviders(){return data.a}async getProvider(providerId){return data.a[Number(providerId)-1]||null}async confirmProvider(provider){return!0}async unconfirmProvider(provider){return!0}async reconfirmProvider(provider){return!0}async backupData(){return"foobar"}}var react=__webpack_require__("./node_modules/react/index.js"),jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const MediatorApiContext=(0,react.createContext)(void 0),MediatorApiProvider=_ref=>{let{children}=_ref;const api=new MediatorApi;return(0,jsx_runtime.jsx)(MediatorApiContext.Provider,{value:{api},children})};MediatorApiProvider.displayName="MediatorApiProvider";const useMediatorApi=()=>{const context=(0,react.useContext)(MediatorApiContext);if(void 0===context)throw new Error("You cant use useMediatorApi without MediatorApiProvider!");return context.api};try{MediatorApiProvider.displayName="MediatorApiProvider",MediatorApiProvider.__docgenInfo={description:"",displayName:"MediatorApiProvider",props:{}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/apps/mediator/common/MediatorApiContext.tsx#MediatorApiProvider"]={docgenInfo:MediatorApiProvider.__docgenInfo,name:"MediatorApiProvider",path:"src/apps/mediator/common/MediatorApiContext.tsx#MediatorApiProvider"})}catch(__react_docgen_typescript_loader_error){}},"./src/backend/backend.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{y:()=>backend});var vanellus__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/vanellus/dist/index.js");const store=new vanellus__WEBPACK_IMPORTED_MODULE_0__.StorageStore(new vanellus__WEBPACK_IMPORTED_MODULE_0__.InMemoryStorage),temporaryStore=new vanellus__WEBPACK_IMPORTED_MODULE_0__.StorageStore(new vanellus__WEBPACK_IMPORTED_MODULE_0__.InMemoryStorage),backend=new vanellus__WEBPACK_IMPORTED_MODULE_0__.Backend({appointment:{properties:{}},apiUrls:{storage:"https://storage.kiebitz.eu/jsonrpc",appointments:"https://appointments.kiebitz.eu/jsonrpc"}},store,temporaryStore)}}]);